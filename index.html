<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C·ªù Caro Meme AI 2.0</title>
<style>
  body {
    background: #1c1c1c;
    color: #fff;
    font-family: "Segoe UI", sans-serif;
    text-align: center;
  }

  h1 {
    margin-top: 20px;
    color: #00d9ff;
    text-shadow: 0 0 10px #00ffff;
  }

  #board {
    display: grid;
    grid-template-columns: repeat(15, 40px);
    justify-content: center;
    gap: 2px;
    margin-top: 30px;
  }

  .cell {
    width: 40px;
    height: 40px;
    border: 1px solid #444;
    background-color: #222;
    font-size: 22px;
    color: #fff;
    cursor: pointer;
  }

  .cell:hover {
    background-color: #333;
  }

  #status {
    margin-top: 15px;
    font-size: 18px;
    color: #ffcc00;
  }

  #chat {
    margin-top: 20px;
    background: #111;
    border-radius: 10px;
    width: 70%;
    height: 120px;
    margin-left: auto;
    margin-right: auto;
    overflow-y: auto;
    padding: 10px;
    text-align: left;
  }

  .ai-msg {
    color: #00ff88;
    margin: 5px 0;
  }

  .player-msg {
    color: #ff6666;
    margin: 5px 0;
  }

  button {
    margin-top: 20px;
    background: #00e0ff;
    border: none;
    padding: 10px 20px;
    color: #000;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }

  button:hover {
    background: #00ffaa;
  }

  footer {
    margin-top: 30px;
    color: #888;
    font-size: 13px;
  }
</style>
</head>
<body>
<h1>ü§ñ C·ªù Caro Meme AI 2.0 ü§ñ</h1>
<div id="board"></div>
<div id="status">B·∫°n ƒëi tr∆∞·ªõc (X)</div>
<div id="chat"></div>
<button onclick="resetGame()">Ch∆°i l·∫°i</button>
<footer>Cre: Nguy·ªÖn H·∫£i Huy üíô</footer>

<script>
const size = 15;
const winLength = 5;
let board = Array.from({length: size}, () => Array(size).fill(''));
let gameOver = false;

const boardDiv = document.getElementById("board");
const statusDiv = document.getElementById("status");
const chatDiv = document.getElementById("chat");

function renderBoard() {
  boardDiv.innerHTML = '';
  for (let i=0;i<size;i++){
    for (let j=0;j<size;j++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.textContent = board[i][j];
      cell.onclick = () => playerMove(i,j);
      boardDiv.appendChild(cell);
    }
  }
}
renderBoard();

function addChat(msg, ai=false){
  const div = document.createElement('div');
  div.className = ai ? 'ai-msg' : 'player-msg';
  div.textContent = (ai ? "ü§ñ " : "üßç ") + msg;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

function playerMove(x,y){
  if (gameOver || board[x][y]) return;
  board[x][y] = 'X';
  renderBoard();
  if (checkWin('X')){
    statusDiv.textContent = "üéâ B·∫°n th·∫Øng r·ªìi! AI t·ªïn th∆∞∆°ng l√≤ng t·ª± tr·ªçng ü§ñ";
    addChat("Kh√¥ng th·ªÉ n√†o... ng∆∞·ªùi n√†y bi·∫øt ch∆°i th·∫≠t!", true);
    gameOver = true;
    return;
  }
  statusDiv.textContent = "AI ƒëang suy nghƒ©...";
  setTimeout(aiMove, 600);
}

function aiMove(){
  if (gameOver) return;
  let move = findBestMove();
  if (!move) move = randomMove();
  const [x,y] = move;
  board[x][y] = 'O';
  renderBoard();

  const memes = [
    "Hehe, b·ªã ta ch·∫∑n r·ªìi üòé",
    "Ta nh√¨n th·∫•y n∆∞·ªõc ƒëi c·ªßa ng∆∞∆°i t·ª´ 3 b∆∞·ªõc tr∆∞·ªõc üòè",
    "D·ªÖ th√¥i, con ng∆∞·ªùi y·∫øu ƒëu·ªëi qu√°...",
    "K√≠ch ho·∫°t l√° b√†i ph·∫£n c√¥ng!",
  ];
  addChat(memes[Math.floor(Math.random()*memes.length)], true);

  if (checkWin('O')){
    statusDiv.textContent = "üíÄ AI th·∫Øng r·ªìi! Kh√¥ng th·ªÉ tho√°t kh·ªèi ƒë·ªãnh m·ªánh ü§ñ";
    addChat("T·ª± h√†o ch∆∞a? Ta m·ªõi d√πng 20% c√¥ng l·ª±c th√¥i üòè", true);
    gameOver = true;
    return;
  }
  statusDiv.textContent = "L∆∞·ª£t c·ªßa b·∫°n!";
}

// --- AI th√¥ng minh ---
function findBestMove(){
  let bestScore = -Infinity;
  let bestMove = null;

  for (let i=0;i<size;i++){
    for (let j=0;j<size;j++){
      if (board[i][j] === ''){
        board[i][j] = 'O';
        const score = evaluateBoard('O');
        board[i][j] = '';
        if (score > bestScore){
          bestScore = score;
          bestMove = [i,j];
        }
      }
    }
  }

  // ∆Øu ti√™n ch·∫∑n ng∆∞·ªùi ch∆°i n·∫øu h·ªç g·∫ßn th·∫Øng
  const danger = findDangerMove();
  return danger || bestMove;
}

// --- Ki·ªÉm tra n∆∞·ªõc ng∆∞·ªùi ch∆°i s·∫Øp th·∫Øng ---
function findDangerMove(){
  for (let i=0;i<size;i++){
    for (let j=0;j<size;j++){
      if (board[i][j] === ''){
        board[i][j] = 'X';
        if (checkWin('X')){
          board[i][j] = '';
          addChat("Ng∆∞∆°i t∆∞·ªüng th·∫Øng √†? B·ªã ta ch·∫∑n r·ªìi üòé", true);
          return [i,j];
        }
        board[i][j] = '';
      }
    }
  }
  return null;
}

// --- Ch·∫•m ƒëi·ªÉm chi·∫øn thu·∫≠t ---
function evaluateBoard(player){
  const lines = getAllLines();
  let score = 0;

  lines.forEach(line => {
    const str = line.join('');
    if (str.includes('OOOO')) score += 10000;
    else if (str.includes('OOO')) score += 1000;
    else if (str.includes('OO')) score += 200;
    if (str.includes('XXXX')) score -= 5000;
    else if (str.includes('XXX')) score -= 1500;
  });

  return score;
}

// L·∫•y t·∫•t c·∫£ h√†ng, c·ªôt, ch√©o
function getAllLines(){
  const lines = [];
  for (let i=0;i<size;i++){
    lines.push(board[i]);
    lines.push(board.map(r=>r[i]));
  }

  for (let k=0;k<size;k++){
    let d1=[], d2=[];
    for (let i=0;i<size-k;i++){
      d1.push(board[i][i+k]);
      d2.push(board[i+k][i]);
    }
    lines.push(d1, d2);
  }

  for (let k=1;k<size;k++){
    let d1=[], d2=[];
    for (let i=0;i<size-k;i++){
      d1.push(board[i+k][i]);
      d2.push(board[i][i+k]);
    }
    lines.push(d1,d2);
  }

  return lines;
}

// --- Ki·ªÉm tra th·∫Øng ---
function checkWin(p){
  const win = p.repeat(winLength);
  for (let i=0;i<size;i++){
    if (board[i].join('').includes(win)) return true;
    if (board.map(r=>r[i]).join('').includes(win)) return true;
  }
  for (let x=0;x<=size-winLength;x++){
    for (let y=0;y<=size-winLength;y++){
      let d1='', d2='';
      for (let k=0;k<winLength;k++){
        d1+=board[x+k][y+k];
        d2+=board[x+k][y+winLength-1-k];
      }
      if (d1===win || d2===win) return true;
    }
  }
  return false;
}

function randomMove(){
  const empty = [];
  for (let i=0;i<size;i++)
    for (let j=0;j<size;j++)
      if (board[i][j]==='') empty.push([i,j]);
  return empty[Math.floor(Math.random()*empty.length)];
}

function resetGame(){
  board = Array.from({length: size}, () => Array(size).fill(''));
  gameOver = false;
  statusDiv.textContent = "B·∫°n ƒëi tr∆∞·ªõc (X)";
  chatDiv.innerHTML = '';
  renderBoard();
}
</script>
</body>
</html>
