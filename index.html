<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>C·ªù Caro AI 99% Fix</title>
<style>
  body {
    background: #121212;
    color: #fff;
    font-family: "Poppins", sans-serif;
    text-align: center;
  }

  h1 {
    color: #00eaff;
    text-shadow: 0 0 10px #00ffff;
    margin-top: 15px;
  }

  #board-container {
    overflow: auto;
    touch-action: pinch-zoom;
    margin: 0 auto;
    width: 95vw;
    max-width: 720px;
    border: 2px solid #333;
    border-radius: 8px;
    background: #1a1a1a;
  }

  #board {
    display: grid;
    grid-template-columns: repeat(19, 36px);
    justify-content: center;
    margin: 0 auto;
    gap: 1px;
    transform-origin: center center;
  }

  .cell {
    width: 36px;
    height: 36px;
    background: #1e1e1e;
    border: 1px solid #333;
    font-size: 22px;
    font-weight: bold;
    cursor: pointer;
  }

  .cell:hover {
    background: #272727;
  }

  .x {
    color: #ff4f6d;
  }

  .o {
    color: #00eaff;
  }

  #status {
    font-size: 18px;
    margin-top: 10px;
  }

  button {
    margin-top: 20px;
    padding: 10px 20px;
    background: #00eaff;
    color: #000;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
  }

  button:hover {
    background: #00ffaa;
  }

  footer {
    margin-top: 20px;
    color: #888;
    font-size: 14px;
  }
</style>
</head>
<body>
<h1>C·ªú CARO AI 99% ü§ñ</h1>
<div id="board-container">
  <div id="board"></div>
</div>
<div id="status">L∆∞·ª£t c·ªßa b·∫°n (X)</div>
<button onclick="resetGame()">Ch∆°i l·∫°i</button>
<footer>Cre: Nguy·ªÖn H·∫£i Huy üíô</footer>

<script>
const size = 19;
const winLen = 5;
let board = Array.from({length: size}, () => Array(size).fill(''));
let gameOver = false;

const boardDiv = document.getElementById("board");
const statusDiv = document.getElementById("status");

function renderBoard() {
  boardDiv.innerHTML = "";
  for (let i=0; i<size; i++){
    for (let j=0; j<size; j++){
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.textContent = board[i][j];
      if (board[i][j]==="X") cell.classList.add("x");
      if (board[i][j]==="O") cell.classList.add("o");
      cell.onclick = () => playerMove(i,j);
      boardDiv.appendChild(cell);
    }
  }
}
renderBoard();

function playerMove(i,j){
  if (gameOver || board[i][j]!=="") return;
  board[i][j]="X";
  renderBoard();
  if (checkWin("X")){
    statusDiv.textContent = "üéâ B·∫°n th·∫Øng r·ªìi! AI b·ªã h·∫° g·ª•c üòÖ";
    gameOver = true;
    return;
  }
  statusDiv.textContent = "AI ƒëang suy nghƒ©...";
  setTimeout(aiMove, 400);
}

function aiMove(){
  if (gameOver) return;
  const [x, y] = findBestMove();
  board[x][y] = "O";
  renderBoard();
  if (checkWin("O")){
    statusDiv.textContent = "ü§ñ AI th·∫Øng! Tr√≠ tu·ªá nh√¢n t·∫°o t·ªëi th∆∞·ª£ng!";
    gameOver = true;
    return;
  }
  statusDiv.textContent = "L∆∞·ª£t c·ªßa b·∫°n (X)";
}

function findBestMove(){
  let bestScore = -Infinity;
  let move = null;

  const activeCells = getActiveCells(3); // ch·ªâ x√©t v√πng quanh c√°c qu√¢n

  for (let [i,j] of activeCells){
    if (board[i][j]===""){
      board[i][j] = "O";
      const score = evaluate(i,j,"O") + Math.random()*10;
      board[i][j] = "";
      if (score > bestScore){
        bestScore = score;
        move = [i,j];
      }
    }
  }
  // n·∫øu b√†n tr·ªëng -> trung t√¢m
  return move || [Math.floor(size/2), Math.floor(size/2)];
}

// ch·ªâ xem v√πng quanh c√°c qu√¢n c·ªù c√≥ s·∫µn
function getActiveCells(radius){
  const cells = new Set();
  for (let i=0;i<size;i++){
    for (let j=0;j<size;j++){
      if (board[i][j]!==""){
        for (let dx=-radius; dx<=radius; dx++){
          for (let dy=-radius; dy<=radius; dy++){
            let nx=i+dx, ny=j+dy;
            if (nx>=0 && ny>=0 && nx<size && ny<size){
              cells.add(nx+","+ny);
            }
          }
        }
      }
    }
  }
  return [...cells].map(s=>s.split(",").map(Number));
}

function evaluate(x,y,player){
  let total = 0;
  const opponent = (player==="O") ? "X" : "O";
  const dirs = [[1,0],[0,1],[1,1],[1,-1]];
  for (let [dx,dy] of dirs){
    total += scoreLine(x,y,dx,dy,player,opponent);
  }
  return total;
}

function scoreLine(x,y,dx,dy,me,enemy){
  let countMe=0, countEnemy=0, openEnds=0;

  for (let dir=-1;dir<=1;dir+=2){
    let step=1;
    while(true){
      let nx=x+dx*step*dir, ny=y+dy*step*dir;
      if (nx<0||ny<0||nx>=size||ny>=size) break;
      if (board[nx][ny]===me) countMe++;
      else if (board[nx][ny]==="") {openEnds++; break;}
      else break;
      step++;
    }
  }

  let myScore = [0,10,80,800,8000,99999][countMe] || 0;
  if (openEnds===2) myScore *= 2;

  for (let dir=-1;dir<=1;dir+=2){
    let step=1;
    while(true){
      let nx=x+dx*step*dir, ny=y+dy*step*dir;
      if (nx<0||ny<0||nx>=size||ny>=size) break;
      if (board[nx][ny]===enemy) countEnemy++;
      else if (board[nx][ny]==="") break;
      else break;
      step++;
    }
  }
  let defScore = [0,10,100,900,9000,100000][countEnemy] || 0;
  return myScore + defScore;
}

function checkWin(p){
  const win = p.repeat(winLen);
  for (let i=0;i<size;i++){
    if (board[i].join("").includes(win)) return true;
    if (board.map(r=>r[i]).join("").includes(win)) return true;
  }
  for (let x=0;x<=size-winLen;x++){
    for (let y=0;y<=size-winLen;y++){
      let d1="", d2="";
      for (let k=0;k<winLen;k++){
        d1+=board[x+k][y+k];
        d2+=board[x+k][y+winLen-1-k];
      }
      if (d1===win || d2===win) return true;
    }
  }
  return false;
}

function resetGame(){
  board = Array.from({length:size},()=>Array(size).fill(''));
  gameOver=false;
  statusDiv.textContent="B·∫°n ƒëi tr∆∞·ªõc (X)";
  renderBoard();
}
</script>
</body>
</html>
